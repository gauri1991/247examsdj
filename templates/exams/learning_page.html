{% extends 'base/base.html' %}
{% load static %}

{% block title %}Learn: {{ node.title }}{% endblock %}

{% block extra_css %}
<!-- MathJax for LaTeX rendering -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']]
  }
};
</script>

<!-- Highlight.js for code syntax highlighting -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

<!-- Plotly.js for interactive graphs -->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<!-- Monaco Editor for code playground -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs/loader.min.js"></script>

<style>
/* ENTERPRISE-GRADE LEARNING PAGE STYLES */
.learning-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    background-attachment: fixed;
}

.learning-content-wrapper {
    background: white;
    margin: 0;
    min-height: 100vh;
    display: flex;
}

/* LEFT SIDEBAR - NAVIGATION & PROGRESS */
.learning-sidebar {
    width: 320px;
    background: #1a202c;
    color: white;
    padding: 0;
    position: fixed;
    height: 100vh;
    overflow-y: auto;
    z-index: 100;
    box-shadow: 2px 0 10px rgba(0,0,0,0.1);
}

.sidebar-header {
    padding: 20px;
    background: linear-gradient(135deg, #2d3748, #1a202c);
    border-bottom: 1px solid #2d3748;
}

.breadcrumb-nav {
    font-size: 12px;
    color: #a0aec0;
    margin-bottom: 10px;
}

.breadcrumb-nav a {
    color: #63b3ed;
    text-decoration: none;
}

.topic-title {
    font-size: 18px;
    font-weight: 700;
    color: white;
    margin: 0;
    line-height: 1.3;
}

.topic-meta {
    display: flex;
    gap: 15px;
    margin-top: 15px;
    font-size: 12px;
}

.meta-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-weight: 600;
}

.difficulty-easy { background: #48bb78; }
.difficulty-medium { background: #ed8936; }
.difficulty-hard { background: #f56565; }
.difficulty-expert { background: #9f7aea; }

.time-badge { background: #4299e1; }

/* LEVEL NAVIGATION */
.level-navigation {
    padding: 20px;
    border-bottom: 1px solid #2d3748;
}

.level-nav-title {
    font-size: 14px;
    font-weight: 600;
    color: #e2e8f0;
    margin-bottom: 15px;
}

.level-buttons {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.level-btn {
    background: #2d3748;
    border: 1px solid #4a5568;
    color: #e2e8f0;
    padding: 12px 16px;
    border-radius: 8px;
    text-align: left;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
    font-weight: 500;
}

.level-btn:hover {
    background: #4a5568;
    border-color: #63b3ed;
}

.level-btn.active {
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-color: #667eea;
    color: white;
}

.level-btn.locked {
    background: #1a202c;
    border-color: #2d3748;
    color: #718096;
    cursor: not-allowed;
}

.level-progress {
    width: 100%;
    height: 4px;
    background: #2d3748;
    border-radius: 2px;
    margin-top: 8px;
    overflow: hidden;
}

.level-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #48bb78, #38a169);
    transition: width 0.5s ease;
}

/* OVERALL PROGRESS */
.overall-progress {
    padding: 20px;
    border-bottom: 1px solid #2d3748;
}

.progress-title {
    font-size: 14px;
    font-weight: 600;
    color: #e2e8f0;
    margin-bottom: 10px;
}

.progress-circle {
    width: 80px;
    height: 80px;
    margin: 0 auto 15px;
    position: relative;
}

.progress-text {
    text-align: center;
    font-size: 12px;
    color: #a0aec0;
}

/* MAIN CONTENT AREA */
.learning-main {
    flex: 1;
    margin-left: 320px;
    background: white;
}

.content-header {
    background: white;
    padding: 20px 40px;
    border-bottom: 1px solid #e2e8f0;
    position: sticky;
    top: 0;
    z-index: 90;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.content-title {
    font-size: 28px;
    font-weight: 700;
    color: #1a202c;
    margin: 0 0 10px 0;
}

.content-subtitle {
    font-size: 16px;
    color: #4a5568;
    margin: 0;
}

.content-actions {
    display: flex;
    gap: 15px;
    margin-top: 20px;
}

.action-btn {
    padding: 8px 16px;
    border-radius: 6px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 14px;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
}

.btn-secondary {
    background: #e2e8f0;
    color: #4a5568;
}

.btn-success {
    background: #48bb78;
    color: white;
}

.action-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* CONTENT SECTIONS */
.content-body {
    padding: 40px;
    max-width: 900px;
    margin: 0 auto;
    line-height: 1.8;
}

.content-section {
    margin-bottom: 50px;
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    border: 1px solid #e2e8f0;
}

.section-header {
    background: linear-gradient(135deg, #f7fafc, #edf2f7);
    padding: 20px 30px;
    border-bottom: 1px solid #e2e8f0;
}

.section-title {
    font-size: 20px;
    font-weight: 700;
    color: #2d3748;
    margin: 0;
}

.section-description {
    font-size: 14px;
    color: #718096;
    margin: 5px 0 0 0;
}

.section-content {
    padding: 30px;
    font-size: 16px;
    color: #2d3748;
}

/* MATHEMATICAL CONTENT STYLING */
.math-equation {
    background: #f7fafc;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
    text-align: center;
    font-size: 18px;
}

.math-derivation {
    background: #fefefe;
    border-left: 4px solid #667eea;
    padding: 20px;
    margin: 20px 0;
}

/* INTERACTIVE ELEMENTS */
.interactive-container {
    background: #f8f9fa;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    padding: 25px;
    margin: 25px 0;
}

.interactive-title {
    font-size: 18px;
    font-weight: 600;
    color: #495057;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.interactive-title::before {
    content: "🎮";
    font-size: 20px;
}

.graph-container {
    width: 100%;
    height: 400px;
    background: white;
    border-radius: 8px;
    border: 1px solid #dee2e6;
}

.slider-controls {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-top: 20px;
}

.slider-group {
    flex: 1;
    min-width: 200px;
}

.slider-label {
    display: block;
    font-weight: 600;
    color: #495057;
    margin-bottom: 8px;
}

.slider-input {
    width: 100%;
    height: 6px;
    border-radius: 3px;
    background: #dee2e6;
    outline: none;
    opacity: 0.7;
    transition: opacity 0.2s;
}

.slider-input:hover {
    opacity: 1;
}

.slider-input::-webkit-slider-thumb {
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #667eea;
    cursor: pointer;
}

.slider-value {
    font-weight: 600;
    color: #667eea;
    margin-left: 10px;
}

/* CODE PLAYGROUND */
.code-playground {
    background: #1e1e1e;
    border-radius: 12px;
    overflow: hidden;
    margin: 25px 0;
}

.code-header {
    background: #2d2d30;
    padding: 15px 20px;
    display: flex;
    justify-content: between;
    align-items: center;
    border-bottom: 1px solid #3e3e42;
}

.code-title {
    color: #cccccc;
    font-weight: 600;
    margin: 0;
}

.code-actions {
    display: flex;
    gap: 10px;
}

.code-btn {
    padding: 6px 12px;
    background: #0e639c;
    color: white;
    border: none;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
}

.code-editor {
    height: 300px;
}

.code-output {
    background: #0f0f0f;
    color: #cccccc;
    padding: 15px 20px;
    border-top: 1px solid #3e3e42;
    font-family: 'Courier New', monospace;
    white-space: pre-wrap;
    max-height: 200px;
    overflow-y: auto;
}

/* ASSESSMENT SECTION */
.assessment-container {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border-radius: 12px;
    padding: 30px;
    margin: 30px 0;
}

.assessment-title {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 15px;
    text-align: center;
}

.assessment-description {
    text-align: center;
    margin-bottom: 25px;
    opacity: 0.9;
}

.question-card {
    background: white;
    color: #2d3748;
    border-radius: 8px;
    padding: 25px;
    margin-bottom: 20px;
}

.question-text {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 20px;
    line-height: 1.6;
}

.question-options {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.option-item {
    display: flex;
    align-items: center;
    padding: 15px;
    background: #f7fafc;
    border: 2px solid transparent;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.option-item:hover {
    background: #edf2f7;
    border-color: #cbd5e0;
}

.option-item.selected {
    background: #e6fffa;
    border-color: #38b2ac;
}

.option-radio {
    margin-right: 15px;
}

.option-text {
    flex: 1;
    font-size: 15px;
}

.assessment-submit {
    text-align: center;
    margin-top: 25px;
}

.submit-btn {
    background: #48bb78;
    color: white;
    border: none;
    padding: 12px 30px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
}

.submit-btn:hover {
    background: #38a169;
    transform: translateY(-1px);
}

/* NOTES AND BOOKMARKS */
.notes-section {
    background: #fffbf0;
    border: 1px solid #fed7aa;
    border-radius: 12px;
    padding: 25px;
    margin: 25px 0;
}

.notes-title {
    font-size: 18px;
    font-weight: 600;
    color: #92400e;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.notes-title::before {
    content: "📝";
}

.notes-textarea {
    width: 100%;
    min-height: 120px;
    border: 1px solid #fed7aa;
    border-radius: 8px;
    padding: 15px;
    font-size: 14px;
    resize: vertical;
    font-family: inherit;
}

.notes-actions {
    margin-top: 15px;
    display: flex;
    gap: 10px;
}

/* NAVIGATION FOOTER */
.content-navigation {
    background: #f7fafc;
    padding: 30px 40px;
    border-top: 1px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.nav-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 20px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.2s ease;
}

.nav-btn-prev {
    background: #e2e8f0;
    color: #4a5568;
}

.nav-btn-next {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
}

.nav-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.nav-btn.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

/* RESPONSIVE DESIGN */
@media (max-width: 1024px) {
    .learning-sidebar {
        width: 280px;
    }
    
    .learning-main {
        margin-left: 280px;
    }
    
    .content-body {
        padding: 30px 25px;
    }
}

@media (max-width: 768px) {
    .learning-sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }
    
    .learning-sidebar.mobile-open {
        transform: translateX(0);
    }
    
    .learning-main {
        margin-left: 0;
    }
    
    .content-header {
        padding: 15px 20px;
    }
    
    .content-body {
        padding: 20px 15px;
    }
    
    .section-content {
        padding: 20px;
    }
}

/* LOADING ANIMATIONS */
.loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid #f3f4f6;
    border-top: 3px solid #667eea;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.fade-in {
    animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>
{% endblock %}

{% block content %}
<div class="learning-container">
    <div class="learning-content-wrapper">
        <!-- LEFT SIDEBAR -->
        <div class="learning-sidebar" id="learningSidebar">
            <!-- Header with Topic Info -->
            <div class="sidebar-header">
                <div class="breadcrumb-nav">
                    {% for breadcrumb in node.get_breadcrumb %}
                        <a href="#">{{ breadcrumb.title }}</a>
                        {% if not forloop.last %} → {% endif %}
                    {% endfor %}
                </div>
                <h1 class="topic-title">{{ node.title }}</h1>
                <div class="topic-meta">
                    <span class="meta-badge difficulty-{{ node.difficulty }}">{{ node.get_difficulty_display }}</span>
                    <span class="meta-badge time-badge">{{ node.estimated_hours }}h</span>
                </div>
            </div>
            
            <!-- Level Navigation -->
            <div class="level-navigation">
                <div class="level-nav-title">Learning Levels</div>
                <div class="level-buttons">
                    <button class="level-btn active" data-level="basic">
                        🟢 Basic Fundamentals
                        <div class="level-progress">
                            <div class="level-progress-fill" style="width: 100%;"></div>
                        </div>
                    </button>
                    <button class="level-btn" data-level="intermediate">
                        🟡 Intermediate Applications
                        <div class="level-progress">
                            <div class="level-progress-fill" style="width: 0%;"></div>
                        </div>
                    </button>
                    <button class="level-btn locked" data-level="advanced">
                        🔴 Advanced Theory
                        <div class="level-progress">
                            <div class="level-progress-fill" style="width: 0%;"></div>
                        </div>
                    </button>
                    <button class="level-btn locked" data-level="expert">
                        🟣 Expert Research
                        <div class="level-progress">
                            <div class="level-progress-fill" style="width: 0%;"></div>
                        </div>
                    </button>
                </div>
            </div>
            
            <!-- Overall Progress -->
            <div class="overall-progress">
                <div class="progress-title">Overall Progress</div>
                <div class="progress-circle">
                    <svg width="80" height="80">
                        <circle cx="40" cy="40" r="36" stroke="#2d3748" stroke-width="4" fill="none"/>
                        <circle cx="40" cy="40" r="36" stroke="#48bb78" stroke-width="4" fill="none" 
                                stroke-dasharray="226" stroke-dashoffset="170" stroke-linecap="round"/>
                        <text x="40" y="45" text-anchor="middle" fill="#e2e8f0" font-size="14" font-weight="600">25%</text>
                    </svg>
                </div>
                <div class="progress-text">1 of 4 levels completed</div>
            </div>
        </div>
        
        <!-- MAIN CONTENT -->
        <div class="learning-main">
            <!-- Content Header -->
            <div class="content-header">
                <h1 class="content-title" id="contentTitle">Fourier Transform Fundamentals</h1>
                <p class="content-subtitle" id="contentSubtitle">Understanding the mathematical foundation and physical interpretation</p>
                <div class="content-actions">
                    <button class="action-btn btn-primary" onclick="toggleNotes()">
                        📝 Take Notes
                    </button>
                    <button class="action-btn btn-secondary" onclick="bookmarkSection()">
                        🔖 Bookmark
                    </button>
                    <button class="action-btn btn-success" onclick="markCompleted()">
                        ✅ Mark Complete
                    </button>
                </div>
            </div>
            
            <!-- Dynamic Content Body -->
            <div class="content-body" id="contentBody">
                <!-- Content will be loaded here dynamically -->
            </div>
            
            <!-- Navigation Footer -->
            <div class="content-navigation">
                <a href="#" class="nav-btn nav-btn-prev">
                    ← Previous Topic
                </a>
                <a href="#" class="nav-btn nav-btn-next">
                    Next Topic →
                </a>
            </div>
        </div>
    </div>
</div>

<script>
// ENTERPRISE-GRADE LEARNING PAGE JAVASCRIPT
class LearningPageEngine {
    constructor() {
        this.currentLevel = 'basic';
        this.nodeId = '{{ node.id }}';
        this.startTime = Date.now();
        this.contentData = {};
        this.userProgress = {};
        
        this.init();
    }
    
    init() {
        this.loadContentData();
        this.setupEventListeners();
        this.startTimeTracking();
        this.loadUserProgress();
    }
    
    setupEventListeners() {
        // Level navigation
        document.querySelectorAll('.level-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                if (!btn.classList.contains('locked')) {
                    this.switchLevel(btn.dataset.level);
                }
            });
        });
        
        // Window focus/blur for time tracking
        window.addEventListener('focus', () => this.resumeTimeTracking());
        window.addEventListener('blur', () => this.pauseTimeTracking());
        
        // Auto-save notes
        document.addEventListener('input', (e) => {
            if (e.target.classList.contains('notes-textarea')) {
                this.autoSaveNotes(e.target.value);
            }
        });
    }
    
    loadContentData() {
        // In a real implementation, this would fetch from the backend
        this.contentData = {
            basic: {
                title: "Fourier Transform Fundamentals",
                subtitle: "Understanding the mathematical foundation and physical interpretation",
                sections: [
                    {
                        title: "What is the Fourier Transform?",
                        type: "theory",
                        content: this.getBasicTheoryContent()
                    },
                    {
                        title: "Interactive Visualization",
                        type: "interactive",
                        content: this.getInteractiveContent()
                    },
                    {
                        title: "Quick Assessment",
                        type: "assessment",
                        content: this.getAssessmentContent()
                    }
                ]
            },
            intermediate: {
                title: "Fourier Transform Properties",
                subtitle: "Mathematical properties and their applications",
                sections: [
                    {
                        title: "Linearity Property",
                        type: "theory",
                        content: this.getIntermediateContent()
                    }
                ]
            }
            // ... more levels
        };
        
        this.loadLevel(this.currentLevel);
    }
    
    switchLevel(level) {
        // Update UI
        document.querySelectorAll('.level-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`[data-level="${level}"]`).classList.add('active');
        
        this.currentLevel = level;
        this.loadLevel(level);
        
        // Track level switch
        this.trackProgress('level_switch', { level });
    }
    
    loadLevel(level) {
        const levelData = this.contentData[level];
        if (!levelData) return;
        
        // Update header
        document.getElementById('contentTitle').textContent = levelData.title;
        document.getElementById('contentSubtitle').textContent = levelData.subtitle;
        
        // Load content sections
        const contentBody = document.getElementById('contentBody');
        contentBody.innerHTML = '';
        
        levelData.sections.forEach((section, index) => {
            const sectionElement = this.createSectionElement(section, index);
            contentBody.appendChild(sectionElement);
        });
        
        // Initialize interactive elements
        this.initializeInteractiveElements();
        
        // Re-render MathJax
        if (window.MathJax) {
            MathJax.typesetPromise();
        }
        
        // Highlight code
        hljs.highlightAll();
    }
    
    createSectionElement(section, index) {
        const sectionDiv = document.createElement('div');
        sectionDiv.className = 'content-section fade-in';
        sectionDiv.style.animationDelay = `${index * 0.1}s`;
        
        sectionDiv.innerHTML = `
            <div class="section-header">
                <h2 class="section-title">${section.title}</h2>
                <p class="section-description">Step ${index + 1} of ${this.contentData[this.currentLevel].sections.length}</p>
            </div>
            <div class="section-content">
                ${section.content}
            </div>
        `;
        
        return sectionDiv;
    }
    
    getBasicTheoryContent() {
        return `
            <p>The <strong>Fourier Transform</strong> is one of the most powerful mathematical tools in signal processing and engineering. It allows us to analyze signals in the frequency domain, revealing the frequency components that make up a signal.</p>
            
            <div class="math-equation">
                $$F(\\omega) = \\int_{-\\infty}^{\\infty} f(t) e^{-j\\omega t} dt$$
            </div>
            
            <p>Where:</p>
            <ul>
                <li><strong>F(ω)</strong> is the frequency domain representation</li>
                <li><strong>f(t)</strong> is the time domain signal</li>
                <li><strong>ω</strong> is the angular frequency</li>
                <li><strong>j</strong> is the imaginary unit</li>
            </ul>
            
            <h3>Physical Interpretation</h3>
            <p>Think of the Fourier Transform as a "frequency analyzer" that decomposes any signal into its constituent frequencies, much like a prism decomposes white light into its color spectrum.</p>
            
            <div class="math-derivation">
                <h4>Key Insight:</h4>
                <p>Every signal can be represented as a sum of sinusoidal waves of different frequencies, amplitudes, and phases. The Fourier Transform finds these frequency components!</p>
            </div>
        `;
    }
    
    getInteractiveContent() {
        return `
            <div class="interactive-container">
                <div class="interactive-title">Interactive Fourier Transform Visualizer</div>
                <p>Explore how different time-domain signals look in the frequency domain. Adjust the parameters below to see real-time changes!</p>
                
                <div class="graph-container" id="fourierGraph"></div>
                
                <div class="slider-controls">
                    <div class="slider-group">
                        <label class="slider-label">Frequency 1 (Hz)</label>
                        <input type="range" class="slider-input" id="freq1" min="1" max="10" value="2" step="0.1">
                        <span class="slider-value">2.0 Hz</span>
                    </div>
                    <div class="slider-group">
                        <label class="slider-label">Amplitude 1</label>
                        <input type="range" class="slider-input" id="amp1" min="0" max="2" value="1" step="0.1">
                        <span class="slider-value">1.0</span>
                    </div>
                    <div class="slider-group">
                        <label class="slider-label">Frequency 2 (Hz)</label>
                        <input type="range" class="slider-input" id="freq2" min="0" max="10" value="5" step="0.1">
                        <span class="slider-value">5.0 Hz</span>
                    </div>
                    <div class="slider-group">
                        <label class="slider-label">Amplitude 2</label>
                        <input type="range" class="slider-input" id="amp2" min="0" max="2" value="0.5" step="0.1">
                        <span class="slider-value">0.5</span>
                    </div>
                </div>
            </div>
        `;
    }
    
    getAssessmentContent() {
        return `
            <div class="assessment-container">
                <div class="assessment-title">🎯 Quick Knowledge Check</div>
                <div class="assessment-description">Test your understanding of Fourier Transform basics before moving to the next level!</div>
                
                <div class="question-card">
                    <div class="question-text">
                        What does the Fourier Transform convert a signal from?
                    </div>
                    <div class="question-options">
                        <div class="option-item" data-value="a">
                            <input type="radio" name="q1" value="a" class="option-radio">
                            <span class="option-text">Frequency domain to time domain</span>
                        </div>
                        <div class="option-item" data-value="b">
                            <input type="radio" name="q1" value="b" class="option-radio">
                            <span class="option-text">Time domain to frequency domain</span>
                        </div>
                        <div class="option-item" data-value="c">
                            <input type="radio" name="q1" value="c" class="option-radio">
                            <span class="option-text">Analog to digital</span>
                        </div>
                        <div class="option-item" data-value="d">
                            <input type="radio" name="q1" value="d" class="option-radio">
                            <span class="option-text">Continuous to discrete</span>
                        </div>
                    </div>
                </div>
                
                <div class="assessment-submit">
                    <button class="submit-btn" onclick="learningEngine.submitAssessment()">
                        Submit Answer
                    </button>
                </div>
            </div>
        `;
    }
    
    initializeInteractiveElements() {
        // Initialize Fourier Transform visualizer
        if (document.getElementById('fourierGraph')) {
            this.initializeFourierGraph();
        }
        
        // Setup assessment interactions
        document.querySelectorAll('.option-item').forEach(option => {
            option.addEventListener('click', () => {
                // Clear previous selections
                option.parentElement.querySelectorAll('.option-item').forEach(opt => {
                    opt.classList.remove('selected');
                });
                // Select current
                option.classList.add('selected');
                option.querySelector('input').checked = true;
            });
        });
    }
    
    initializeFourierGraph() {
        // Create sample data
        const t = Array.from({length: 1000}, (_, i) => i * 0.01);
        const updatePlot = () => {
            const freq1 = parseFloat(document.getElementById('freq1').value);
            const amp1 = parseFloat(document.getElementById('amp1').value);
            const freq2 = parseFloat(document.getElementById('freq2').value);
            const amp2 = parseFloat(document.getElementById('amp2').value);
            
            const signal = t.map(time => 
                amp1 * Math.sin(2 * Math.PI * freq1 * time) + 
                amp2 * Math.sin(2 * Math.PI * freq2 * time)
            );
            
            const trace1 = {
                x: t,
                y: signal,
                type: 'scatter',
                mode: 'lines',
                name: 'Time Domain Signal',
                line: {color: '#667eea', width: 2}
            };
            
            // Simple frequency domain representation
            const frequencies = [0, freq1, freq2, 10];
            const magnitudes = [0, amp1, amp2, 0];
            
            const trace2 = {
                x: frequencies,
                y: magnitudes,
                type: 'scatter',
                mode: 'markers+lines',
                name: 'Frequency Domain',
                marker: {color: '#48bb78', size: 8},
                line: {color: '#48bb78', width: 2},
                yaxis: 'y2'
            };
            
            const layout = {
                title: 'Fourier Transform Visualization',
                xaxis: {title: 'Time (s) / Frequency (Hz)'},
                yaxis: {title: 'Amplitude', side: 'left'},
                yaxis2: {title: 'Magnitude', side: 'right', overlaying: 'y'},
                showlegend: true,
                height: 400
            };
            
            Plotly.newPlot('fourierGraph', [trace1, trace2], layout, {responsive: true});
        };
        
        // Setup slider event listeners
        ['freq1', 'amp1', 'freq2', 'amp2'].forEach(id => {
            const slider = document.getElementById(id);
            if (slider) {
                slider.addEventListener('input', (e) => {
                    e.target.nextElementSibling.textContent = `${parseFloat(e.target.value).toFixed(1)}${id.includes('freq') ? ' Hz' : ''}`;
                    updatePlot();
                });
            }
        });
        
        updatePlot();
    }
    
    submitAssessment() {
        const selectedAnswer = document.querySelector('input[name="q1"]:checked');
        if (!selectedAnswer) {
            alert('Please select an answer!');
            return;
        }
        
        const isCorrect = selectedAnswer.value === 'b';
        
        if (isCorrect) {
            alert('🎉 Correct! The Fourier Transform converts signals from time domain to frequency domain.');
            this.unlockNextLevel();
        } else {
            alert('❌ Not quite right. The Fourier Transform converts from time domain to frequency domain. Try again!');
        }
        
        this.trackProgress('assessment_attempt', {
            question: 'fourier_basic_1',
            answer: selectedAnswer.value,
            correct: isCorrect
        });
    }
    
    unlockNextLevel() {
        const nextBtn = document.querySelector('[data-level="intermediate"]');
        if (nextBtn) {
            nextBtn.classList.remove('locked');
            nextBtn.style.opacity = '1';
        }
    }
    
    trackProgress(action, data) {
        // Send progress tracking to backend
        fetch(`/exams/api/node/${this.nodeId}/track-progress/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: JSON.stringify({
                action: action,
                level: this.currentLevel,
                data: data,
                timestamp: new Date().toISOString()
            })
        });
    }
    
    startTimeTracking() {
        this.timeTracker = setInterval(() => {
            const timeSpent = (Date.now() - this.startTime) / 1000 / 60; // minutes
            this.trackProgress('time_update', { timeSpent });
        }, 30000); // Track every 30 seconds
    }
    
    autoSaveNotes(content) {
        clearTimeout(this.notesSaveTimeout);
        this.notesSaveTimeout = setTimeout(() => {
            this.trackProgress('notes_update', { notes: content });
        }, 2000);
    }
}

// Initialize the learning engine
let learningEngine;
document.addEventListener('DOMContentLoaded', () => {
    learningEngine = new LearningPageEngine();
});

// Utility functions
function toggleNotes() {
    // Implementation for notes toggle
    console.log('Toggle notes');
}

function bookmarkSection() {
    // Implementation for bookmarking
    console.log('Bookmark section');
}

function markCompleted() {
    // Implementation for marking complete
    console.log('Mark completed');
}
</script>
{% endblock %}